<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>13-Redis 哨兵机制 | 算法吧</title><meta name="description" content="欢迎来到算法吧">
    <link rel="preload" href="/wiki/assets/js/runtime~app.29cef883.js" as="script"><link rel="preload" href="/wiki/assets/css/styles.9208e122.css" as="style"><link rel="preload" href="/wiki/assets/js/1812.bf7cb9e3.js" as="script"><link rel="preload" href="/wiki/assets/js/app.b0b6b1c8.js" as="script">
    <link rel="stylesheet" href="/wiki/assets/css/styles.9208e122.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/wiki/" class=""><!----><span class="site-name can-hide">算法吧</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/wiki/SpringCloud/" class="nav-link" aria-label="微服务 SpringCloud"><!--[--><!--]--> 微服务 SpringCloud <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/Redis/" class="nav-link router-link-active" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/RabbitMQ/" class="nav-link" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/ElasticSearch/" class="nav-link" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/Blog/" class="nav-link" aria-label="Blog"><!--[--><!--]--> Blog <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/wiki/LeetBook/" class="nav-link" aria-label="/LeetBook/"><!--[--><!--]--> /LeetBook/ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/wiki/LeetCode/" class="nav-link" aria-label="/LeetCode/"><!--[--><!--]--> /LeetCode/ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Group"><span class="title">Group</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Group"><span class="title">Group</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/wiki/group/foo.md" class="nav-link" aria-label="/group/foo.md"><!--[--><!--]--> /group/foo.md <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/wiki/group/bar.md" class="nav-link" aria-label="/group/bar.md"><!--[--><!--]--> /group/bar.md <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/wiki/tools/vuepress.html" class="nav-link" aria-label="Vuepress 常用样式语法"><!--[--><!--]--> Vuepress 常用样式语法 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/suanfa8/wiki" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/wiki/SpringCloud/" class="nav-link" aria-label="微服务 SpringCloud"><!--[--><!--]--> 微服务 SpringCloud <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/Redis/" class="nav-link router-link-active" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/RabbitMQ/" class="nav-link" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/ElasticSearch/" class="nav-link" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/wiki/Blog/" class="nav-link" aria-label="Blog"><!--[--><!--]--> Blog <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/wiki/LeetBook/" class="nav-link" aria-label="/LeetBook/"><!--[--><!--]--> /LeetBook/ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/wiki/LeetCode/" class="nav-link" aria-label="/LeetCode/"><!--[--><!--]--> /LeetCode/ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Group"><span class="title">Group</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Group"><span class="title">Group</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/wiki/group/foo.md" class="nav-link" aria-label="/group/foo.md"><!--[--><!--]--> /group/foo.md <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/wiki/group/bar.md" class="nav-link" aria-label="/group/bar.md"><!--[--><!--]--> /group/bar.md <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/wiki/tools/vuepress.html" class="nav-link" aria-label="Vuepress 常用样式语法"><!--[--><!--]--> Vuepress 常用样式语法 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/suanfa8/wiki" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/wiki/Redis/1-NoSQL.html" class="nav-link sidebar-heading sidebar-item" aria-label="第 1-6 章"><!--[--><!--]--> 第 1-6 章 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/7-Redis-install.html" class="nav-link sidebar-heading sidebar-item" aria-label="7-Redis 安装（重点）"><!--[--><!--]--> 7-Redis 安装（重点） <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/8-Redis-commands.html" class="nav-link sidebar-heading sidebar-item" aria-label="8-Redis 数据库相关指令"><!--[--><!--]--> 8-Redis 数据库相关指令 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/9-AOF.html" class="nav-link sidebar-heading sidebar-item" aria-label="9-持久化机制"><!--[--><!--]--> 9-持久化机制 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/10-Java.html" class="nav-link sidebar-heading sidebar-item" aria-label="10-Java 操作 Redis"><!--[--><!--]--> 10-Java 操作 Redis <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/11-SpringBoot.html" class="nav-link sidebar-heading sidebar-item" aria-label="11. SpringBoot 整合 Redis"><!--[--><!--]--> 11. SpringBoot 整合 Redis <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/12-Master-Slave-copy.html" class="nav-link sidebar-heading sidebar-item" aria-label="12. Redis 主从复制"><!--[--><!--]--> 12. Redis 主从复制 <!--[--><!--]--></a><!----><!--]--><!--[--><a aria-current="page" href="/wiki/Redis/13-sentinel.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-heading sidebar-item active" aria-label="13-Redis 哨兵机制"><!--[--><!--]--> 13-Redis 哨兵机制 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/14-Redis-Cluster.html" class="nav-link sidebar-heading sidebar-item" aria-label="14-Redis集群"><!--[--><!--]--> 14-Redis集群 <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/wiki/Redis/15-Redis-Distributed-Session.html" class="nav-link sidebar-heading sidebar-item" aria-label="15-Redis实现分布式Session管理"><!--[--><!--]--> 15-Redis实现分布式Session管理 <!--[--><!--]--></a><!----><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="_13-redis-哨兵机制" tabindex="-1"><a class="header-anchor" href="#_13-redis-哨兵机制" aria-hidden="true">#</a> 13-Redis 哨兵机制</h1><h2 id="_13-1-哨兵sentinel机制" tabindex="-1"><a class="header-anchor" href="#_13-1-哨兵sentinel机制" aria-hidden="true">#</a> 13.1 哨兵Sentinel机制</h2><p>Sentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。简单的说哨兵就是带有<strong>自动故障转移功能的主从架构</strong>。</p><p><strong>无法解决: 1.单节点并发压力问题 2.单节点内存和磁盘物理上限</strong></p><h3 id="_13-2-哨兵架构原理" tabindex="-1"><a class="header-anchor" href="#_13-2-哨兵架构原理" aria-hidden="true">#</a> 13.2 哨兵架构原理</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwtoyy92doj32js0ootfc.jpg" alt="image-20200627204422750"></p><h3 id="_13-3-搭建哨兵架构" tabindex="-1"><a class="header-anchor" href="#_13-3-搭建哨兵架构" aria-hidden="true">#</a> 13.3 搭建哨兵架构</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在主节点上创建哨兵配置</span>
<span class="token list punctuation">-</span> 在Master对应redis.conf同目录下新建sentinel.conf文件，名字绝对不能错；

<span class="token title important"><span class="token punctuation">#</span> 2.配置哨兵，在sentinel.conf文件中填入内容：</span>
- sentinel monitor 被监控数据库名字（自己起名字） ip port 1

<span class="token title important"><span class="token punctuation">#</span> 3.启动哨兵模式进行测试</span>
- redis-sentinel  /root/sentinel/sentinel.conf
	说明:这个后面的数字2,是指当有两个及以上的sentinel服务检测到master宕机，才会去执行主从切换的功能。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_13-4-通过springboot操作哨兵" tabindex="-1"><a class="header-anchor" href="#_13-4-通过springboot操作哨兵" aria-hidden="true">#</a> 13.4 通过springboot操作哨兵</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># redis sentinel 配置</span>
<span class="token comment"># master书写是使用哨兵监听的那个名称</span>
<span class="token attr-name">spring.redis.sentinel.master</span><span class="token punctuation">=</span><span class="token attr-value">mymaster</span>
<span class="token comment"># 连接的不再是一个具体redis主机,书写的是多个哨兵节点</span>
<span class="token attr-name">spring.redis.sentinel.nodes</span><span class="token punctuation">=</span><span class="token attr-value">192.168.202.206:26379</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>注意:如果连接过程中出现如下错误:RedisConnectionException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command &#39;CONFIG SET protected-mode no&#39; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2)</strong></li><li><strong>解决方案:在哨兵的配置文件中加入bind 0.0.0.0 开启远程连接权限</strong></li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwtoz2924rj31zo0f0787.jpg" alt="image-20200629154647970"></p><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/suanfa8/wiki/edit/main/Redis/13-sentinel.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/29/2021, 3:09:00 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 45396320+suanfa8@users.noreply.github.com">suanfa8</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/wiki/Redis/12-Master-Slave-copy.html" class="nav-link" aria-label="12. Redis 主从复制"><!--[--><!--]--> 12. Redis 主从复制 <!--[--><!--]--></a></span><span class="next"><a href="/wiki/Redis/14-Redis-Cluster.html" class="nav-link" aria-label="14-Redis集群"><!--[--><!--]--> 14-Redis集群 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/wiki/assets/js/runtime~app.29cef883.js" defer></script><script src="/wiki/assets/js/1812.bf7cb9e3.js" defer></script><script src="/wiki/assets/js/app.b0b6b1c8.js" defer></script>
  </body>
</html>
