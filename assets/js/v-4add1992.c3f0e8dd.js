"use strict";(self.webpackChunkblog_tools=self.webpackChunkblog_tools||[]).push([[3703],{1476:(n,e,s)=>{s.r(e),s.d(e,{data:()=>a});const a={key:"v-4add1992",path:"/Redis/13-sentinel.html",title:"13-Redis 哨兵机制",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"13.1 哨兵Sentinel机制",slug:"_13-1-哨兵sentinel机制",children:[{level:3,title:"13.2 哨兵架构原理",slug:"_13-2-哨兵架构原理",children:[]},{level:3,title:"13.3 搭建哨兵架构",slug:"_13-3-搭建哨兵架构",children:[]},{level:3,title:"13.4 通过springboot操作哨兵",slug:"_13-4-通过springboot操作哨兵",children:[]}]},{level:2,title:"",slug:"",children:[]}],filePathRelative:"Redis/13-sentinel.md",git:{updatedTime:163819854e4,contributors:[{name:"suanfa8",email:"45396320+suanfa8@users.noreply.github.com",commits:3}]}}},6868:(n,e,s)=>{s.r(e),s.d(e,{default:()=>i});const a=(0,s(6252).uE)('<h1 id="_13-redis-哨兵机制" tabindex="-1"><a class="header-anchor" href="#_13-redis-哨兵机制" aria-hidden="true">#</a> 13-Redis 哨兵机制</h1><h2 id="_13-1-哨兵sentinel机制" tabindex="-1"><a class="header-anchor" href="#_13-1-哨兵sentinel机制" aria-hidden="true">#</a> 13.1 哨兵Sentinel机制</h2><p>Sentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。简单的说哨兵就是带有<strong>自动故障转移功能的主从架构</strong>。</p><p><strong>无法解决: 1.单节点并发压力问题 2.单节点内存和磁盘物理上限</strong></p><h3 id="_13-2-哨兵架构原理" tabindex="-1"><a class="header-anchor" href="#_13-2-哨兵架构原理" aria-hidden="true">#</a> 13.2 哨兵架构原理</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwtoyy92doj32js0ootfc.jpg" alt="image-20200627204422750"></p><h3 id="_13-3-搭建哨兵架构" tabindex="-1"><a class="header-anchor" href="#_13-3-搭建哨兵架构" aria-hidden="true">#</a> 13.3 搭建哨兵架构</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在主节点上创建哨兵配置</span>\n<span class="token list punctuation">-</span> 在Master对应redis.conf同目录下新建sentinel.conf文件，名字绝对不能错；\n\n<span class="token title important"><span class="token punctuation">#</span> 2.配置哨兵，在sentinel.conf文件中填入内容：</span>\n- sentinel monitor 被监控数据库名字（自己起名字） ip port 1\n\n<span class="token title important"><span class="token punctuation">#</span> 3.启动哨兵模式进行测试</span>\n- redis-sentinel  /root/sentinel/sentinel.conf\n\t说明:这个后面的数字2,是指当有两个及以上的sentinel服务检测到master宕机，才会去执行主从切换的功能。\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_13-4-通过springboot操作哨兵" tabindex="-1"><a class="header-anchor" href="#_13-4-通过springboot操作哨兵" aria-hidden="true">#</a> 13.4 通过springboot操作哨兵</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># redis sentinel 配置</span>\n<span class="token comment"># master书写是使用哨兵监听的那个名称</span>\n<span class="token attr-name">spring.redis.sentinel.master</span><span class="token punctuation">=</span><span class="token attr-value">mymaster</span>\n<span class="token comment"># 连接的不再是一个具体redis主机,书写的是多个哨兵节点</span>\n<span class="token attr-name">spring.redis.sentinel.nodes</span><span class="token punctuation">=</span><span class="token attr-value">192.168.202.206:26379</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>注意:如果连接过程中出现如下错误:RedisConnectionException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command &#39;CONFIG SET protected-mode no&#39; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2)</strong></li><li><strong>解决方案:在哨兵的配置文件中加入bind 0.0.0.0 开启远程连接权限</strong></li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwtoz2924rj31zo0f0787.jpg" alt="image-20200629154647970"></p><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2>',13),t={},i=(0,s(3744).Z)(t,[["render",function(n,e){return a}]])},3744:(n,e)=>{e.Z=(n,e)=>{const s=n.__vccOpts||n;for(const[n,a]of e)s[n]=a;return s}}}]);