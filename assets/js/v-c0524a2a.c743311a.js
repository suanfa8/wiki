"use strict";(self.webpackChunkblog_tools=self.webpackChunkblog_tools||[]).push([[4893],{6350:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-c0524a2a",path:"/SpringCloud/7-communication/7-2-RestTemplate.html",title:"7-2 基于 RestTemplate 的服务调用",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"操作",slug:"操作",children:[{level:3,title:"1、RestTemplate 服务调用",slug:"_1、resttemplate-服务调用",children:[]},{level:3,title:"2、在商品服务中提供服务方法",slug:"_2、在商品服务中提供服务方法",children:[]},{level:3,title:"3、在用户服务中使用 RestTemplate 进行调用",slug:"_3、在用户服务中使用-resttemplate-进行调用",children:[]},{level:3,title:"4、启动服务",slug:"_4、启动服务",children:[]},{level:3,title:"5、测试服务调用",slug:"_5、测试服务调用",children:[]}]},{level:2,title:"总结",slug:"总结",children:[{level:3,title:"RestTemplate 直接调用存在问题",slug:"resttemplate-直接调用存在问题",children:[]}]}],filePathRelative:"SpringCloud/7-communication/7-2-RestTemplate.md",git:{updatedTime:1638145972e3,contributors:[{name:"suanfa8",email:"45396320+suanfa8@users.noreply.github.com",commits:2}]}}},330:(n,s,a)=>{a.r(s),a.d(s,{default:()=>b});var t=a(6252);const e=(0,t._)("h1",{id:"_7-2-基于-resttemplate-的服务调用",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#_7-2-基于-resttemplate-的服务调用","aria-hidden":"true"},"#"),(0,t.Uk)(" 7-2 基于 RestTemplate 的服务调用")],-1),p={class:"table-of-contents"},l=(0,t.Uk)("操作"),c=(0,t.Uk)("1、RestTemplate 服务调用"),o=(0,t.Uk)("2、在商品服务中提供服务方法"),u=(0,t.Uk)("3、在用户服务中使用 RestTemplate 进行调用"),i=(0,t.Uk)("4、启动服务"),r=(0,t.Uk)("5、测试服务调用"),k=(0,t.Uk)("总结"),m=(0,t.Uk)("RestTemplate 直接调用存在问题"),d=(0,t.uE)('<p>说明：Spring 框架提供的 RestTemplate 类可用于在应用中调用 rest 服务，它简化了与 http 服务的通信方式，统一了 RESTful 的标准，封装了 http 链接，我们只需要传入 url 及返回值类型即可。相较于之前常用的 HttpClient，RestTemplate 是一种更优雅的调用 RESTful 服务的方式。</p><h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作" aria-hidden="true">#</a> 操作</h2><h3 id="_1、resttemplate-服务调用" tabindex="-1"><a class="header-anchor" href="#_1、resttemplate-服务调用" aria-hidden="true">#</a> 1、<code>RestTemplate</code> 服务调用</h3><p>创建两个服务并注册到 consul 注册中心中。</p><ul><li>users：代表用户服务，端口为 9999</li><li>products：代表商品服务，端口为 9998</li></ul><p>注意：这里服务仅仅用来测试，没有实际业务意义。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7j0zzy5j31cs030dg4.jpg" alt="image-20200713101224125"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7j2mapxj32ak07kwi2.jpg" alt="image-20200713101422031"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">9999</span>\n<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">users</span>\n\n<span class="token attr-name">spring.cloud.consul.port</span><span class="token punctuation">=</span><span class="token attr-value">8500</span>\n<span class="token attr-name">spring.cloud.consul.host</span><span class="token punctuation">=</span><span class="token attr-value">localhost</span>\n<span class="token attr-name">spring.cloud.consul.discovery.service-name</span><span class="token punctuation">=</span><span class="token attr-value">${spring.application.name}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">9998</span>\n<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">products</span>\n\n<span class="token attr-name">spring.cloud.consul.port</span><span class="token punctuation">=</span><span class="token attr-value">8500</span>\n<span class="token attr-name">spring.cloud.consul.host</span><span class="token punctuation">=</span><span class="token attr-value">localhost</span>\n<span class="token attr-name">spring.cloud.consul.discovery.service-name</span><span class="token punctuation">=</span><span class="token attr-value">${spring.application.name}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2、在商品服务中提供服务方法" tabindex="-1"><a class="header-anchor" href="#_2、在商品服务中提供服务方法" aria-hidden="true">#</a> 2、在商品服务中提供服务方法</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductController</span> <span class="token punctuation">{</span>\n    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>\n    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/product/findAll&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;商品服务查询所有调用成功,当前服务端口:[{}]&quot;</span><span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;服务调用成功,服务提供端口为: &quot;</span><span class="token operator">+</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> map<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7j6191uj325u0m6jvx.jpg" alt="image-20200713101553893"></p><h3 id="_3、在用户服务中使用-resttemplate-进行调用" tabindex="-1"><a class="header-anchor" href="#_3、在用户服务中使用-resttemplate-进行调用" aria-hidden="true">#</a> 3、在用户服务中使用 <code>RestTemplate</code> 进行调用</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7j7myugj32bc0i6gpc.jpg" alt="image-20200713102053530"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>\n    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/findAll&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;调用用户服务...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">//1.使用restTemplate调用商品服务</span>\n        <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token class-name">String</span> forObject <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:9998/product/findAll&quot;</span><span class="token punctuation">,</span> \n                                                     <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> forObject<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4、启动服务" tabindex="-1"><a class="header-anchor" href="#_4、启动服务" aria-hidden="true">#</a> 4、启动服务</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7jagx03j32bc05kwf4.jpg" alt="image-20200713102320469"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7jcbauxj32ji0n8ju5.jpg" alt="image-20200713140350189"></p><h3 id="_5、测试服务调用" tabindex="-1"><a class="header-anchor" href="#_5、测试服务调用" aria-hidden="true">#</a> 5、测试服务调用</h3><p>浏览器访问用户服务</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://localhost:9999/user/findAll\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7jf7wdyj31x40e6tbn.jpg" alt="image-20200713102454337"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu7l54pzwj31sg03ata0.jpg" alt="image-20200713102616311"></p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>RestTemplate 是直接基于服务地址调用没有在服务注册中心获取服务,也没有办法完成服务的负载均衡如果需要实现服务的负载均衡需要自己书写服务负载均衡策略。</p><h3 id="resttemplate-直接调用存在问题" tabindex="-1"><a class="header-anchor" href="#resttemplate-直接调用存在问题" aria-hidden="true">#</a> RestTemplate 直接调用存在问题</h3><ul><li>直接使用 <code>restTemplate</code> 方式调用没有经过服务注册中心获取服务地址，代码写死不利于维护，当服务宕机时不能高效剔除；</li><li>调用服务时 <strong>没有负载均衡</strong> 需要自己实现负载均衡策略。</li></ul>',28),g={},b=(0,a(3744).Z)(g,[["render",function(n,s){const a=(0,t.up)("RouterLink");return(0,t.wg)(),(0,t.iD)(t.HY,null,[e,(0,t._)("nav",p,[(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"#操作"},{default:(0,t.w5)((()=>[l])),_:1}),(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_1、resttemplate-服务调用"},{default:(0,t.w5)((()=>[c])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_2、在商品服务中提供服务方法"},{default:(0,t.w5)((()=>[o])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_3、在用户服务中使用-resttemplate-进行调用"},{default:(0,t.w5)((()=>[u])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_4、启动服务"},{default:(0,t.w5)((()=>[i])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_5、测试服务调用"},{default:(0,t.w5)((()=>[r])),_:1})])])]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#总结"},{default:(0,t.w5)((()=>[k])),_:1}),(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"#resttemplate-直接调用存在问题"},{default:(0,t.w5)((()=>[m])),_:1})])])])])]),d],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);