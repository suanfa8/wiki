"use strict";(self.webpackChunkblog_tools=self.webpackChunkblog_tools||[]).push([[4826],{2407:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-5325240b",path:"/SpringCloud/11-Config/11-2-Config-client.html",title:"",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"11-2 Config Client 开发",slug:"_11-2-config-client-开发",children:[]}],filePathRelative:"SpringCloud/11-Config/11-2-Config-client.md",git:{updatedTime:1638143942e3,contributors:[{name:"suanfa8",email:"45396320+suanfa8@users.noreply.github.com",commits:1}]}}},7207:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(6252).uE)('<h2 id="_11-2-config-client-开发" tabindex="-1"><a class="header-anchor" href="#_11-2-config-client-开发" aria-hidden="true">#</a> 11-2 Config Client 开发</h2><ol><li>项目中引入 config client 依赖</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入config client --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>编写配置文件</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 开启统一配置中心服务</span>\n<span class="token attr-name">spring.cloud.config.discovery.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>\n<span class="token comment"># 指定统一配置服务中心的服务唯一标识              </span>\n<span class="token attr-name">spring.cloud.config.discovery.service-id</span><span class="token punctuation">=</span><span class="token attr-value">configserver</span>\n<span class="token comment"># 指定从仓库的那个分支拉取配置    </span>\n<span class="token attr-name">spring.cloud.config.label</span><span class="token punctuation">=</span><span class="token attr-value">master</span>\n<span class="token comment"># 指定拉取配置文件的名称                                                  </span>\n<span class="token attr-name">spring.cloud.config.name</span><span class="token punctuation">=</span><span class="token attr-value">client</span>\n<span class="token comment"># 指定拉取配置文件的环境                                                     </span>\n<span class="token attr-name">spring.cloud.config.profile</span><span class="token punctuation">=</span><span class="token attr-value">dev                                                     </span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="3"><li>远程仓库创建配置文件</li></ol><ul><li><code>client.properties</code>（用来存放公共配置）</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.application.name=configclient\nspring.cloud.consul.host=localhost\nspring.cloud.consul.port=8500\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>client-dev.properties</code>，用来存放研发相关配置，注意:这里端口为例，以后不同配置分别存放</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server.port=9099\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>client-prod.properties</code>，用来存放生产相关配置</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server.port=9098\t\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82jthsrj31du0b2wge.jpg" alt="image-20200722102322149"></p><ol start="4"><li>启动客户端服务进行远程配置拉取测试</li></ol><p>直接启动过程中发现无法启动直接报错。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82mkle4j32c606wq6u.jpg" alt="image-20200722102851999"><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82rq02rj32am08uafx.jpg" alt="image-20200722102901146"></p><p>报错原因：项目中目前使用的是 <code>application.properties</code> 启动项目，使用这个配置文件在 springboot 项目启动过程中不会等待远程配置拉取，直接根据配置文件中内容启动，因此当需要注册中心,服务端口等信息时,远程配置还没有拉取到,所以直接报错</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82wodp6j32b20b8wiw.jpg" alt="image-20200722103435260"></p><p>解决方案：</p><ul><li>应该在项目启动时先等待拉取远程配置，拉取远程配置成功之后再根据远程配置信息启动即可；</li><li>为了完成上述要求 SpringBoot 官方提供了一种解决方案，就是在使用统一配置中心时应该将微服务的配置文件名修改为 <code>bootstrap.(properties|yml)</code>；</li><li><code>bootstrap.properties</code> 作为配置启动项目时,会优先拉取远程配置,远程配置拉取成功之后根据远程配置启动当前应用。</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu8315kaqj32ds0bggq2.jpg" alt="image-20200722103823678"></p><p>再次启动服务。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu834eacmj31ny086tcr.jpg" alt="image-20200722103913142"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu837alp0j31cq08w424.jpg" alt="image-20200722104031932"></p><p>!&gt; 新问题：希望配置文件 <strong>立即生效</strong>。</p>',25),t={},p=(0,a(3744).Z)(t,[["render",function(n,s){return e}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);