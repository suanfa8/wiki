"use strict";(self.webpackChunkblog_tools=self.webpackChunkblog_tools||[]).push([[4289],{2535:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-3b1fb088",path:"/SpringCloud/11-Config/11-3-flush.html",title:"",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:3,title:"11-3 手动配置刷新",slug:"_11-3-手动配置刷新",children:[]}],filePathRelative:"SpringCloud/11-Config/11-3-flush.md",git:{updatedTime:1638143942e3,contributors:[{name:"suanfa8",email:"45396320+suanfa8@users.noreply.github.com",commits:1}]}}},7930:(n,s,a)=>{a.r(s),a.d(s,{default:()=>l});const t=(0,a(6252).uE)('<h3 id="_11-3-手动配置刷新" tabindex="-1"><a class="header-anchor" href="#_11-3-手动配置刷新" aria-hidden="true">#</a> 11-3 手动配置刷新</h3><p>!&gt; 发送一个 POST 请求。</p><ol><li>说明</li></ol><ul><li>在生产环境中，微服务可能非常多，每次修改完远端配置之后，不可能对所有服务进行重新启动；</li><li>这个时候需要让修改配置的服务能够刷新远端修改之后的配置，从而不要每次重启服务才能生效，进一步提高微服务系统的维护效率；</li><li>在 SpringCloud 中也为我们提供了手动刷新配置和自动刷新配置两种策略，这里我们先试用手动配置文件刷新。</li></ul><ol start="2"><li>在 config client 端加入刷新暴露端点</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 开启所有 web 端点暴露（推荐使用这种）</span>\n<span class="token attr-name">management.endpoints.web.exposure.include</span><span class="token punctuation">=</span><span class="token attr-value">*            </span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83b3d6tj31zs07yn0k.jpg" alt="image-20200730161148097"></p><ol start="3"><li>在需要刷新代码的类中加入刷新配置的注解</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>\n<span class="token annotation punctuation">@RefreshScope</span>\n<span class="token annotation punctuation">@Slf4j</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>\n    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${name}&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>\n    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test/test&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;当前加载配置文件信息为:[{}]&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> name<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83drihhj324g0hqjv0.jpg" alt="image-20200722153537692"></p><ol start="4"><li>在远程配置中加入 name 并启动测试</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83h50m4j31y60haju3.jpg" alt="image-20200722153731602"></p><ol start="5"><li>启动之后直接访问</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83njggej31hw05mjs6.jpg" alt="image-20200722153806932"></p><ol start="6"><li>修改远程配置</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83ra4bjj31wc07q3zh.jpg" alt="image-20200722203225968"></p><ol start="7"><li>修改之后在访问</li></ol><ul><li>发现并没有自动刷新配置?</li><li>必须调用刷新配置接口才能刷新配置</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83usnbyj31qi05gq3s.jpg" alt="image-20200722203317795"></p><ol start="8"><li>手动调用刷新配置接口</li></ol><p>!&gt; 注意：这个 <code>url</code> 是写死的。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -X POST http://localhost:9099/actuator/refresh\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu847t1haj31sy04a3z6.jpg" alt="image-20200722203417879"></p><ol start="9"><li>在次访问发现配置已经成功刷新</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu83zt8pgj31s606ajsf.jpg" alt="image-20200722203452506"></p>',25),e={},l=(0,a(3744).Z)(e,[["render",function(n,s){return t}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);