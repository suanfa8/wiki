"use strict";(self.webpackChunkblog_tools=self.webpackChunkblog_tools||[]).push([[5057],{475:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-48a67d34",path:"/SpringCloud/11-Config/11-1-Config-server.html",title:"",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"11-1 Config 组件使用",slug:"_11-1-config-组件使用",children:[{level:3,title:"什么是 Config",slug:"什么是-config",children:[]},{level:3,title:"Config Server 开发",slug:"config-server-开发",children:[]}]}],filePathRelative:"SpringCloud/11-Config/11-1-Config-server.md",git:{updatedTime:1638143942e3,contributors:[{name:"suanfa8",email:"45396320+suanfa8@users.noreply.github.com",commits:1}]}}},7537:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const t=(0,a(6252).uE)('<h2 id="_11-1-config-组件使用" tabindex="-1"><a class="header-anchor" href="#_11-1-config-组件使用" aria-hidden="true">#</a> 11-1 Config 组件使用</h2><h3 id="什么是-config" tabindex="-1"><a class="header-anchor" href="#什么是-config" aria-hidden="true">#</a> 什么是 Config</h3><p>官方网址：https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.3.RELEASE/reference/html/#_spring_cloud_config_server</p><p>config（配置）又称为「统一配置中心」。顾名思义，就是将配置统一管理，配置统一管理的好处是在日后大规模集群部署服务应用时相同的服务配置一致，日后再修改配置只需要统一修改全部同步，不需要一个一个服务手动维护。</p><p>统一配置中心组件流程图</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu81rfri5j31q40g876c.jpg" alt="统一配置中心组件流程图"></p><h3 id="config-server-开发" tabindex="-1"><a class="header-anchor" href="#config-server-开发" aria-hidden="true">#</a> Config Server 开发</h3><ol><li>引入依赖</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入统一配置中心 --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token comment">&lt;!-- 引入 consul 依赖--&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token comment">&lt;!-- 这个包是用做健康度监控的 --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>开启统一配置中心服务 <code>@EnableConfigServer</code></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>\n<span class="token annotation punctuation">@EnableConfigServer</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configserver7878Application</span> <span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Configserver7878Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu81uid2pj3290080taw.jpg" alt="image-20200721182003376"></p><ol start="3"><li>修改配置文件</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">7878</span>\n<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">configserver</span>\n<span class="token attr-name">spring.cloud.consul.host</span><span class="token punctuation">=</span><span class="token attr-value">localhost</span>\n<span class="token attr-name">spring.cloud.consul.port</span><span class="token punctuation">=</span><span class="token attr-value">8500</span>\n<span class="token attr-name">spring.cloud.consul.discovery.service-name</span><span class="token punctuation">=</span><span class="token attr-value">${spring.application.name}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu81wlmunj31rq04ywg5.jpg" alt="image-20200721182105648"></p><ol start="4"><li>直接启动服务报错</li></ol><ul><li>没有指定远程仓库的相关配置</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu81ytrnoj32480dw76c.jpg" alt="image-20200721182142000"></p><ol start="5"><li>创建远程仓库</li></ol><ul><li>github创建一个仓库</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu822m6onj31eq0lumz6.jpg" alt="image-20200721183541178"></p><ol start="6"><li>复制仓库地址</li></ol><ul><li>https://github.com/chenyn-java/configservers.git</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu825qp6bj31xa0be0uz.jpg" alt="image-20200721183727767"></p><ol start="7"><li>在统一配置中心服务中修改配置文件指向远程仓库地址</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.cloud.config.server.git.uri</span><span class="token punctuation">=</span><span class="token attr-value">https://github.com/chenyn-java/configservers.git</span>\n<span class="token comment">#spring.cloud.config.server.git.username=私有仓库访问用户名       </span>\n<span class="token comment">#spring.cloud.config.server.git.password=私有仓库访问密码\t\t\t\t</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="8"><li>再次启动统一配置中心</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu828v1kij320q06odka.jpg" alt="image-20200721221656436"></p><ol start="9"><li>拉取远端配置 [三种方式][]</li></ol><ul><li><ol><li>http://localhost:7878/test-xxxx.properties</li></ol></li><li><ol start="2"><li>http://localhost:7878/test-xxxx.json</li></ol></li><li><ol start="3"><li>http://localhost:7878/test-xxxx.yml</li></ol></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://localhost:7878/main/order.properties\nhttp://localhost:7878/main/order-xxx.properties\nhttp://localhost:7878/main/order-dev.properties\nhttp://localhost:7878/main/order-prod.properties\n\nhttp://localhost:7878/order/dev\nhttp://localhost:7878/order/prod\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82b6rwoj31v80dadi7.jpg" alt="image-20200721221951670"></p><ol start="10"><li>拉取远端配置规则</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>label/name-profiles.yml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>label</code> 代表：去那个分支获取，默认使用 <code>master</code>分支</li><li><code>name</code> 代表：读取那个具体的配置文件文件名称</li><li><code>profile</code> 代表：读取配置文件环境</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82dskj6j31ni07qaax.jpg" alt="image-20200722105313716"></p><ol start="11"><li>查看拉取配置详细信息</li></ol><ul><li>http://localhost:7878/client/dev [client:代表远端配置名称][dev:代表远程配置的环境]</li></ul><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gvu82fqf7cj31nk0u0dlq.jpg" alt="image-20200722105950808"></p><ol start="12"><li>指定分支和本地仓库位置</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 一定要是一个空目录，在首次会将该目录清空</span>\n<span class="token attr-name">spring.cloud.config.server.git.basedir</span><span class="token punctuation">=</span><span class="token attr-value">/localresp</span>\n<span class="token comment"># 指定使用远程仓库中那个分支中内容</span>\n<span class="token attr-name">spring.cloud.config.server.git.default-label</span><span class="token punctuation">=</span><span class="token attr-value">master</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>',41),p={},e=(0,a(3744).Z)(p,[["render",function(n,s){return t}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);